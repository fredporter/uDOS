# v1.3.18 Spatial LocId Z-Axis Migration Notes

Last updated: 2026-02-15  
Owner: Core + Wizard

## Summary

v1.3.18 extends LocId with an optional vertical axis suffix:

- Previous canonical: `L###-CC##`
- Extended canonical: `L###-CC##[-Zz]`

Backward compatibility is preserved. If `-Zz` is omitted, `z=0` is implied.

## What Changed

- Core TypeScript parser/validation accepts `-Zz` (`core/src/spatial/parse.ts`).
- Wizard Python parser now accepts `-Zz` with the same bounds and layer/cell checks (`wizard/services/spatial_parser.py`).
- Core contract validators now accept/validate `-Zz` tokens (`core/services/anchor_validation.py`, `core/tools/contract_validator.py`).
- Spatial filesystem parser accepts z-aware `grid_locations` for tagging and lookup (`core/services/spatial_filesystem.py`).
- Spatial migration parser accepts z-aware place refs during seed ingestion (`core/services/location_migration_service.py`).

## Accepted Forms

- `L305-DA11`
- `L305-DA11-Z0`
- `L305-DA11-Z-7`
- `EARTH:SUR:L305-DA11-Z2`
- `GAME:skyrim:SUB:L402-CC18-Z1:D3:Iwinterhold`

## Validation Rules

- Layer: `300..899`
- Cell format: `[A-Z]{2}\d{2}`, row `10..39`
- Z range (if present): `-99..99`

## Frontmatter Migration

No data rewrite is required.

- Existing `grid_locations` entries remain valid:
  - `L305-DA11`
- Optional z-axis entries are now valid:
  - `L305-DA11-Z2`
- Existing `places` entries remain valid.
- Optional z-axis `places` entries are now valid:
  - `EARTH:SUR:L305-DA11-Z2`

Example:

```yaml
---
grid_locations:
  - L305-DA11
  - L305-DA11-Z2
places:
  - EARTH:SUR:L305-DA11
  - EARTH:SUR:L305-DA11-Z2
---
```

## CI Gate

- `tools/ci/check_spatial_contract_v1_3_18.py` validates:
  - z-aware parser contract is present in core/wizard sources
  - core anchor validation accepts/rejects z-axis LocIds correctly
  - world contract validation accepts valid z tokens and rejects invalid z tokens
