<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌀 uDOS Dashboard v1.3</title>

    <!-- classic.css - Mac OS 8.1 Interface -->
    <link rel="stylesheet" href="../shared/classic.css">

    <!-- After Dark CSS for screensavers -->
    <link rel="stylesheet" href="https://www.bryanbraun.com/after-dark-css/after-dark.css">

    <!-- Chunky Retro Mac Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323:wght@400&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* CSS Variables for Light/Dark Mode */
        :root {
            --bg-primary: #c0c0c0;
            --bg-secondary: #fff;
            --text-primary: #000;
            --text-secondary: #666;
            --border-color: #000;
            --menu-bg: #fff;
            --menu-hover: #316AC5;
            --button-bg: #ddd;
            --button-shadow: #808080;
            --dot-pattern: #000;
        }

        [data-theme="dark"] {
            --bg-primary: #2a2a2a;
            --bg-secondary: #1a1a1a;
            --text-primary: #00ff00;
            --text-secondary: #888;
            --border-color: #00ff00;
            --menu-bg: #1a1a1a;
            --menu-hover: #003300;
            --button-bg: #333;
            --button-shadow: #555;
            --dot-pattern: #00ff00;
        }

        /* Base styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', 'Chicago', 'Geneva', monospace;
            font-size: 16px;
            letter-spacing: 0.5px;
            background: var(--bg-primary);
            background-image:
                radial-gradient(circle, var(--dot-pattern) 1px, transparent 1px);
            background-size: 4px 4px;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        /* Menu Bar */
        .menu-bar {
            background: var(--menu-bg);
            border-bottom: 2px inset var(--bg-primary);
            padding: 6px 12px;
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 0 var(--border-color);
            color: var(--text-primary);
        }

        .menu-logo {
            font-size: 18px;
            margin-right: 10px;
        }

        .menu-item {
            position: relative;
            padding: 4px 16px;
            cursor: pointer;
            user-select: none;
            border-radius: 0;
            transition: all 0.1s ease;
        }

        .menu-item:hover {
            background: var(--menu-hover);
            color: #fff;
        }

        .menu-item.active {
            background: var(--menu-hover);
            color: #fff;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            margin-left: auto;
            padding: 4px 8px;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            border-radius: 0;
        }

        .theme-toggle:hover {
            background: var(--menu-hover);
            color: #fff;
        }

        .menu-item:hover {
            background: var(--menu-hover);
            color: #fff;
        }

        .menu-item.active {
            background: var(--menu-hover);
            color: #fff;
        }

        .menu-logo {
            font-size: 16px;
            padding: 0 8px;
        }

        /* Dropdown Menu */
        .dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--menu-bg);
            border: 2px solid var(--border-color);
            box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
            min-width: 200px;
            z-index: 1001;
            color: var(--text-primary);
        }

        .dropdown.active {
            display: block;
        }

        .dropdown-item {
            padding: 6px 16px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'VT323', monospace;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--menu-hover);
            color: #fff;
        }

        .dropdown-item.disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .dropdown-item.disabled:hover {
            background: transparent;
            color: var(--text-secondary);
        }

        .dropdown-separator {
            height: 1px;
            background: #000;
            margin: 2px 0;
        }

        .shortcut {
            font-size: 9px;
            color: #666;
            margin-left: 20px;
        }

        .dropdown-item:hover .shortcut {
            color: #fff;
        }

        /* Desktop Container */
        .desktop {
            padding: 20px;
            min-height: calc(100vh - 40px);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 20px;
            align-content: start;
        }

        /* Desktop Icons */
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s ease;
            min-height: 100px;
            justify-content: center;
        }

        .desktop-icon:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .desktop-icon.selected {
            background: rgba(0, 0, 0, 0.2);
        }

        .icon-image {
            width: 48px;
            height: 48px;
            background: #fff;
            border: 2px outset #c0c0c0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 4px;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .icon-label {
            font-size: 11px;
            text-align: center;
            color: #000;
            text-shadow: 1px 1px 0 #fff;
            font-weight: normal;
            max-width: 80px;
            word-wrap: break-word;
        }

        /* Status indicator for icons */
        .icon-status {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 1px solid #000;
        }

        .icon-status.online {
            background: #00ff00;
        }

        .icon-status.offline {
            background: #888;
        }

        /* Dashboard Window Styles */
        .dashboard-window {
            position: fixed;
            top: 50px;
            right: 50px;
            width: 400px;
            z-index: 1000;
        }

        .window {
            background: #fff;
            border: 2px outset #c0c0c0;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.3);
        }

        .title-bar {
            background: #c0c0c0;
            border-bottom: 1px solid #808080;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            cursor: move;
        }

        .title {
            font-weight: bold;
            margin: 0;
            font-size: 12px;
        }

        .close, .resize {
            width: 16px;
            height: 16px;
            border: 1px outset #c0c0c0;
            background: #c0c0c0;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close:active, .resize:active {
            border: 1px inset #c0c0c0;
        }

        .separator {
            height: 1px;
            background: #808080;
        }

        .window-pane {
            padding: 16px;
            background: #fff;
        }

        .metrics-section, .actions-section, .log-section {
            margin-bottom: 16px;
        }

        .metrics-section h3, .actions-section h3, .log-section h3 {
            font-size: 12px;
            margin-bottom: 8px;
            color: #000;
            border-bottom: 1px solid #c0c0c0;
            padding-bottom: 4px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 10px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 4px;
            border: 1px inset #c0c0c0;
            background: #f0f0f0;
        }

        .metric-label {
            color: #666;
        }

        .metric-value {
            font-weight: bold;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
        }

        .btn {
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            padding: 4px 8px;
            font-size: 10px;
            cursor: pointer;
            font-family: inherit;
        }

        .btn:active {
            border: 1px inset #c0c0c0;
        }

        .activity-log {
            height: 100px;
            border: 1px inset #c0c0c0;
            background: #fff;
            overflow-y: auto;
            padding: 4px;
            font-family: 'Monaco', monospace;
            font-size: 9px;
        }

        .log-entry {
            margin-bottom: 2px;
            display: flex;
            gap: 8px;
        }

        .log-time {
            color: #666;
            min-width: 60px;
        }

        .log-message {
            color: #000;
        }

        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #c0c0c0;
            border-top: 1px inset #c0c0c0;
            padding: 4px 12px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            z-index: 999;
        }

        .status-item {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        /* Main window */
        .content {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border: 2px solid #000;
            box-shadow: 4px 4px 0 #000;
        }

        .title {
            background: #000;
            color: #fff;
            padding: 4px 8px;
            font-size: 12px;
            text-align: center;
            border-bottom: 2px solid #000;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .title-text {
            flex: 1;
            text-align: center;
        }

        .title-stripes {
            width: 20px;
            height: 12px;
            background: repeating-linear-gradient(
                90deg,
                #fff,
                #fff 1px,
                transparent 1px,
                transparent 2px
            );
        }

        .window-controls {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .window-btn {
            width: 12px;
            height: 12px;
            border: 1px solid #fff;
            background: #000;
            cursor: pointer;
        }

        .window-btn:hover {
            background: #fff;
        }

        /* Dashboard content */
        .dashboard-content {
            padding: 16px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 16px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .metric-box {
            border: 2px solid #000;
            background: #ddd;
            box-shadow: inset 1px 1px 0 #fff, inset -1px -1px 0 #888;
            padding: 12px;
        }

        .metric-label {
            font-size: 9px;
            color: #666;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #000;
        }

        .metric-icon {
            font-size: 20px;
            float: right;
        }

        .metric-change {
            font-size: 9px;
            color: #006600;
            margin-top: 4px;
        }

        .metric-change.negative {
            color: #cc0000;
        }

        /* Server grid */
        .server-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .server-card {
            border: 2px solid #000;
            background: #fff;
            box-shadow: inset 1px 1px 0 #fff, inset -1px -1px 0 #888;
            padding: 10px;
        }

        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid #888;
        }

        .server-icon {
            font-size: 20px;
        }

        .server-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid #000;
        }

        .server-status.online {
            background: #00ff00;
            box-shadow: 0 0 4px #00ff00;
        }

        .server-status.offline {
            background: #888;
        }

        .server-name {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .server-port {
            font-size: 9px;
            color: #666;
            margin-bottom: 4px;
        }

        .server-url {
            font-size: 8px;
            color: #0000ee;
            text-decoration: underline;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .server-url:hover {
            color: #ee0000;
        }

        .server-actions {
            display: flex;
            gap: 4px;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .info-panel {
            border: 2px solid #000;
            background: #fff;
            box-shadow: inset 1px 1px 0 #fff, inset -1px -1px 0 #888;
        }

        .panel-header {
            background: #ddd;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: bold;
            border-bottom: 1px solid #888;
        }

        .panel-content {
            padding: 10px;
            font-size: 9px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dotted #ccc;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: bold;
        }

        /* Code Box (Mac Classic Terminal Style) */
        .code-box {
            border: 2px solid #000;
            background: #000;
            color: #00ff00;
            font-family: 'Monaco', 'Courier', monospace;
            font-size: 10px;
            padding: 10px;
            margin: 8px 0;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.5);
        }

        .code-box-header {
            color: #00ff00;
            margin-bottom: 6px;
            font-size: 9px;
        }

        .code-line {
            margin: 2px 0;
            white-space: pre;
        }

        .code-prompt {
            color: #ffff00;
        }

        .code-output {
            color: #00ff00;
        }

        .code-error {
            color: #ff0000;
        }

        /* Workspace Browser */
        .workspace-list {
            list-style: none;
            padding: 0;
        }

        .workspace-item {
            padding: 6px 8px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .workspace-item:hover {
            background: #000;
            color: #fff;
        }

        .workspace-icon {
            font-size: 14px;
        }

        .workspace-name {
            flex: 1;
            font-size: 10px;
        }

        .workspace-count {
            font-size: 8px;
            color: #666;
        }

        .workspace-item:hover .workspace-count {
            color: #fff;
        }
        .classic-btn {
            background: var(--button-bg);
            border: 2px solid var(--border-color);
            box-shadow:
                inset -1px -1px 0px var(--border-color),
                inset 1px 1px 0px var(--bg-secondary),
                inset -2px -2px 0px var(--button-shadow),
                inset 2px 2px 0px var(--button-bg);
            padding: 6px 12px;
            font-family: 'VT323', monospace;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            flex: 1;
            color: var(--text-primary);
        }

        .classic-btn:active {
            box-shadow:
                inset 1px 1px 0px var(--border-color),
                inset -1px -1px 0px var(--bg-secondary);
            background: var(--button-shadow);
        }

        .classic-btn:disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .classic-btn-small {
            font-size: 12px;
            padding: 4px 8px;
        }

        /* Screensaver Overlay */
        .screensaver-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
            display: none;
            cursor: none;
        }

        .screensaver-overlay.active {
            display: block;
        }

        /* After Dark CSS Integration */
        .screensaver-starfield {
            background: #000;
            overflow: hidden;
        }

        .screensaver-matrix {
            background: #000;
            color: #00ff00;
            font-family: 'VT323', monospace;
            overflow: hidden;
        }

        .screensaver-pipes {
            background: #000;
            overflow: hidden;
        }

        .screensaver-dvd {
            background: #000;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .screensaver-clock {
            background: #000;
            color: #00ff00;
            font-family: 'VT323', monospace;
            font-size: 72px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        /* DVD Logo Animation */
        .dvd-logo {
            width: 100px;
            height: 50px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #f9ca24);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            position: absolute;
            animation: dvd-bounce 3s linear infinite;
        }

        @keyframes dvd-bounce {
            0% { transform: translate(0, 0); }
            25% { transform: translate(calc(100vw - 100px), 0); }
            50% { transform: translate(calc(100vw - 100px), calc(100vh - 50px)); }
            75% { transform: translate(0, calc(100vh - 50px)); }
            100% { transform: translate(0, 0); }
        }

        /* Matrix Rain */
        .matrix-rain {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .matrix-column {
            position: absolute;
            top: -100%;
            font-size: 14px;
            line-height: 14px;
            animation: matrix-fall linear infinite;
        }

        @keyframes matrix-fall {
            to { top: 100%; }
        }

        /* Starfield */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite alternate;
        }

        @keyframes twinkle {
            from { opacity: 0.3; }
            to { opacity: 1; }
        }

        .classic-btn:active {
            box-shadow:
                inset 1px 1px 0px var(--border-color),
                inset -1px -1px 0px var(--bg-secondary);
            background: var(--button-shadow);
        }

        .classic-btn:disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .classic-btn-small {
            font-size: 12px;
            padding: 4px 8px;
        }

        /* Status bar */
        .status-bar {
            background: var(--button-bg);
            border-top: 2px solid var(--border-color);
            padding: 8px 12px;
            font-size: 14px;
            font-family: 'VT323', monospace;
            display: flex;
            justify-content: space-between;
            box-shadow: inset 0 1px 0 var(--bg-secondary);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            color: var(--text-primary);
        }

        .status-item {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 14px;
        }

        /* Activity log */
        .activity-section {
            margin-top: 12px;
            border: 2px solid #000;
            background: #fff;
        }

        .activity-header {
            background: #ddd;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: bold;
            border-bottom: 1px solid #888;
            display: flex;
            justify-content: space-between;
        }

        .activity-log {
            max-height: 150px;
            overflow-y: auto;
            padding: 8px;
            font-size: 9px;
            font-family: 'Monaco', 'Courier', monospace;
        }

        .log-entry {
            margin-bottom: 4px;
            padding: 2px 4px;
        }

        .log-entry.info {
            color: #000;
        }

        .log-entry.success {
            color: #006600;
        }

        .log-entry.error {
            color: #cc0000;
        }

        .log-time {
            font-weight: bold;
            margin-right: 8px;
        }

        /* Quick actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            background: #ddd;
            border: 2px solid #000;
            box-shadow:
                inset -1px -1px 0px #000,
                inset 1px 1px 0px #fff,
                inset -2px -2px 0px #808080,
                inset 2px 2px 0px #ddd;
            padding: 12px 8px;
            font-family: 'ChicagoFLF', sans-serif;
            font-size: 10px;
            cursor: pointer;
            text-align: center;
        }

        .action-btn:active {
            box-shadow:
                inset 1px 1px 0px #000,
                inset -1px -1px 0px #fff;
            background: #bbb;
        }

        .action-icon {
            font-size: 18px;
            margin-bottom: 4px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-window {
            background: #fff;
            border: 2px solid #000;
            box-shadow: 4px 4px 0 #000;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            background: #000;
            color: #fff;
            padding: 4px 8px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            padding: 0 4px;
        }

        .modal-body {
            padding: 16px;
        }

        .setting-group {
            margin-bottom: 12px;
        }

        .setting-label {
            display: block;
            font-size: 10px;
            margin-bottom: 4px;
            font-weight: bold;
        }

        .setting-input {
            width: 100%;
            padding: 4px;
            border: 2px solid #000;
            background: #fff;
            font-family: 'ChicagoFLF', sans-serif;
            font-size: 10px;
        }

        .modal-footer {
            padding: 12px 16px;
            border-top: 1px solid #888;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 16px;
            height: 16px;
        }

        ::-webkit-scrollbar-track {
            background: #ddd;
            border: 1px solid #888;
        }

        ::-webkit-scrollbar-thumb {
            background: #fff;
            border: 2px solid #000;
            box-shadow: inset 1px 1px 0 #ddd;
        }

        ::-webkit-scrollbar-corner {
            background: #ddd;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .server-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <div class="menu-logo">🌀</div>

        <div class="menu-item" onclick="toggleMenu('file-menu')">
            File
            <div id="file-menu" class="dropdown">
                <div class="dropdown-item" onclick="openWorkspace('sandbox')">
                    <span>📁 Open Sandbox</span>
                    <span class="shortcut">⌘S</span>
                </div>
                <div class="dropdown-item" onclick="openWorkspace('memory')">
                    <span>💾 Open Memory</span>
                    <span class="shortcut">⌘M</span>
                </div>
                <div class="dropdown-item" onclick="openWorkspace('data')">
                    <span>🗄️ Open Data</span>
                    <span class="shortcut">⌘D</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="refreshDashboard()">
                    <span>🔄 Refresh</span>
                    <span class="shortcut">⌘R</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item disabled">
                    <span>🚪 Quit</span>
                    <span class="shortcut">⌘Q</span>
                </div>
            </div>
        </div>

        <div class="menu-item" onclick="toggleMenu('extensions-menu')">
            Extensions
            <div id="extensions-menu" class="dropdown">
                <div class="dropdown-item" onclick="openExtension('cmd')">
                    <span>💻 Terminal</span>
                    <span class="shortcut">:8890</span>
                </div>
                <div class="dropdown-item" onclick="openExtension('markdown-viewer')">
                    <span>📖 Markdown Viewer</span>
                    <span class="shortcut">:8889</span>
                </div>
                <div class="dropdown-item" onclick="openExtension('font-editor')">
                    <span>🎨 Font Editor</span>
                    <span class="shortcut">:8888</span>
                </div>
                <div class="dropdown-item" onclick="openExtension('typo')">
                    <span>✏️ Typo Editor</span>
                    <span class="shortcut">:5173</span>
                </div>
                <div class="dropdown-item" onclick="openExtension('micro')">
                    <span>📝 Micro Editor</span>
                    <span class="shortcut">:8891</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="startAll()">
                    <span>▶️ Start All</span>
                </div>
                <div class="dropdown-item" onclick="stopAll()">
                    <span>⏹️ Stop All</span>
                </div>
            </div>
        </div>

        <div class="menu-item" onclick="toggleMenu('view-menu')">
            View
            <div id="view-menu" class="dropdown">
                <div class="dropdown-item" onclick="toggleTheme()">
                    <span>🌓 Toggle Dark Mode</span>
                    <span class="shortcut">⌘T</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="startScreensaver('starfield')">
                    <span>⭐ Starfield Screensaver</span>
                </div>
                <div class="dropdown-item" onclick="startScreensaver('pipes')">
                    <span>🔧 Pipes Screensaver</span>
                </div>
                <div class="dropdown-item" onclick="startScreensaver('dvd')">
                    <span>📀 DVD Logo Screensaver</span>
                </div>
                <div class="dropdown-item" onclick="startScreensaver('matrix')">
                    <span>🔋 Matrix Rain</span>
                </div>
                <div class="dropdown-item" onclick="startScreensaver('clock')">
                    <span>🕐 Digital Clock</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="stopScreensaver()">
                    <span>⏹️ Stop Screensaver</span>
                    <span class="shortcut">ESC</span>
                </div>
            </div>
        </div>

        <div class="menu-item" onclick="toggleMenu('settings-menu')">>
            System
            <div id="settings-menu" class="dropdown">
                <div class="dropdown-item" onclick="showSystemInfo()">
                    <span>ℹ️ System Information</span>
                </div>
                <div class="dropdown-item" onclick="showSettings()">
                    <span>⚙️ Preferences...</span>
                    <span class="shortcut">⌘,</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="checkAllStatus()">
                    <span>🔍 Check Status</span>
                </div>
                <div class="dropdown-item" onclick="clearLog()">
                    <span>🗑️ Clear Activity Log</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="showAbout()">
                    <span>📋 About uDOS</span>
                </div>
            </div>
        </div>

        <div class="menu-item" onclick="toggleMenu('help-menu')">
            Help
            <div id="help-menu" class="dropdown">
                <div class="dropdown-item" onclick="showHelp()">
                    <span>❓ uDOS Help</span>
                    <span class="shortcut">⌘?</span>
                </div>
                <div class="dropdown-item" onclick="showKeyboardShortcuts()">
                    <span>⌨️ Keyboard Shortcuts</span>
                </div>
                <div class="dropdown-separator"></div>
                <div class="dropdown-item" onclick="window.open('https://github.com/fredporter/uDOS', '_blank')">
                    <span>🔗 GitHub Repository</span>
                </div>
                <div class="dropdown-item" onclick="showDocs()">
                    <span>📚 Documentation</span>
                </div>
            </div>
        </div>

        <!-- Theme Toggle Button -->
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
            🌓
        </button>
    </div>

    <!-- Desktop -->
    <div class="desktop">
        <!-- Extension Icons -->
        <div class="desktop-icon" data-extension="cmd" data-port="8890" onclick="handleIconClick('cmd')">
            <div class="icon-image">💻</div>
            <div class="icon-label">Terminal</div>
            <div class="icon-status offline" id="status-cmd"></div>
        </div>

        <div class="desktop-icon" data-extension="markdown-viewer" data-port="8889" onclick="handleIconClick('markdown-viewer')">
            <div class="icon-image">📖</div>
            <div class="icon-label">Markdown Viewer</div>
            <div class="icon-status offline" id="status-markdown-viewer"></div>
        </div>

        <div class="desktop-icon" data-extension="font-editor" data-port="8888" onclick="handleIconClick('font-editor')">
            <div class="icon-image">🎨</div>
            <div class="icon-label">Font Editor</div>
            <div class="icon-status offline" id="status-font-editor"></div>
        </div>

        <div class="desktop-icon" data-extension="typo" data-port="5173" onclick="handleIconClick('typo')">
            <div class="icon-image">✏️</div>
            <div class="icon-label">Typo Editor</div>
            <div class="icon-status offline" id="status-typo"></div>
        </div>

        <div class="desktop-icon" data-extension="micro" data-port="8891" onclick="handleIconClick('micro')">
            <div class="icon-image">📝</div>
            <div class="icon-label">Micro Editor</div>
            <div class="icon-status offline" id="status-micro"></div>
        </div>

        <!-- CSS Framework Showcase -->
        <div class="desktop-icon" onclick="openURL('http://localhost:8885')">
            <div class="icon-image" style="background: linear-gradient(45deg, #008080, #006666);">🖥️</div>
            <div class="icon-label">Classic.css Demo</div>
        </div>

        <div class="desktop-icon" onclick="openURL('http://localhost:8884')">
            <div class="icon-image" style="background: linear-gradient(45deg, #ff6b6b, #ffd93d);">🎮</div>
            <div class="icon-label">NES.css Demo</div>
        </div>

        <div class="desktop-icon" onclick="openURL('http://localhost:8883')">
            <div class="icon-image" style="background: #f0f0f0;">💾</div>
            <div class="icon-label">System.css Demo</div>
        </div>

        <div class="desktop-icon" onclick="openURL('http://localhost:8882')">
            <div class="icon-image" style="background: linear-gradient(45deg, #000, #333);">✨</div>
            <div class="icon-label">After Dark Demo</div>
        </div>

        <!-- Screensaver Control -->
        <div class="desktop-icon" onclick="showScreensaverMenu()">
            <div class="icon-image" style="background: linear-gradient(45deg, #1a1a1a, #333);">🌌</div>
            <div class="icon-label">Screensavers</div>
        </div>

        <!-- Workspace Folders -->
        <div class="desktop-icon" onclick="openWorkspace('sandbox')">
            <div class="icon-image" style="background: #ffeb3b;">📦</div>
            <div class="icon-label">Sandbox</div>
        </div>

        <div class="desktop-icon" onclick="openWorkspace('memory')">
            <div class="icon-image" style="background: #4caf50;">💾</div>
            <div class="icon-label">Memory</div>
        </div>

        <div class="desktop-icon" onclick="openWorkspace('data')">
            <div class="icon-image" style="background: #2196f3;">🗄️</div>
            <div class="icon-label">Data</div>
        </div>

        <div class="desktop-icon" onclick="openWorkspace('output')">
            <div class="icon-image" style="background: #ff9800;">📤</div>
            <div class="icon-label">Output</div>
        </div>

        <!-- System Tools -->
        <div class="desktop-icon" onclick="showSystemInfo()">
            <div class="icon-image">ℹ️</div>
            <div class="icon-label">System Info</div>
        </div>

        <div class="desktop-icon" onclick="showSettings()">
            <div class="icon-image">⚙️</div>
            <div class="icon-label">Preferences</div>
        </div>

        <!-- Dashboard Window (Floating) -->
        <div class="dashboard-window" id="dashboard-window" style="display: none;">
            <div class="window">
                <div class="title-bar">
                    <button aria-label="Close" class="close" onclick="closeDashboard()"></button>
                    <h1 class="title">🌀 uDOS System Dashboard</h1>
                    <button aria-label="Resize" class="resize"></button>
                </div>
                <div class="separator"></div>
                <div class="window-pane">
                    <!-- System Metrics -->
                    <div class="metrics-section">
                        <h3>System Status</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Active Servers:</span>
                                <span class="metric-value" id="metric-servers">0/6</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Uptime:</span>
                                <span class="metric-value" id="metric-uptime">00:00:00</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Memory:</span>
                                <span class="metric-value" id="metric-memory">-- MB</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Platform:</span>
                                <span class="metric-value" id="platform-info">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="actions-section">
                        <h3>Quick Actions</h3>
                        <div class="action-buttons">
                            <button class="btn" onclick="startAll()">▶️ Start All</button>
                            <button class="btn" onclick="stopAll()">⏹️ Stop All</button>
                            <button class="btn" onclick="refreshDashboard()">🔄 Refresh</button>
                            <button class="btn" onclick="clearLog()">🗑️ Clear Log</button>
                        </div>
                    </div>

                    <!-- Activity Log -->
                    <div class="log-section">
                        <h3>Activity Log</h3>
                        <div class="activity-log" id="activity-log">
                            <div class="log-entry">
                                <span class="log-time">--:--:--</span>
                                <span class="log-message">Dashboard initialized</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Desktop -->

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-window">
            <div class="modal-title">
                <span>⚙️ Settings</span>
                <button class="modal-close" onclick="closeSettings()">✖</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label class="setting-label">Auto-Refresh Interval</label>
                    <select id="auto-refresh" class="setting-input">
                        <option value="0">Disabled</option>
                        <option value="5">5 seconds</option>
                        <option value="10" selected>10 seconds</option>
                        <option value="30">30 seconds</option>
                        <option value="60">60 seconds</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label">Theme</label>
                    <select id="color-theme" class="setting-input">
                        <option value="classic" selected>Classic Mac OS 8.1</option>
                        <option value="dark">Dark Mode</option>
                        <option value="phosphor">Green Phosphor</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="classic-btn" onclick="saveSettings()">Save</button>
                <button class="classic-btn" onclick="closeSettings()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- World Map Modal -->
    <div id="map-modal" class="modal">
        <div class="modal-window" style="max-width: 700px;">
            <div class="modal-title">
                <span>🗺️ World Map</span>
                <button class="modal-close" onclick="closeMap()">✖</button>
            </div>
            <div class="modal-body">
                <div id="map-container" style="min-height: 300px; text-align: center; padding: 20px;">
                    <p>Map data loading...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="classic-btn" onclick="closeMap()">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // ========================================
        // Menu System
        // ========================================
        let activeMenu = null;

        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            const menuItem = menu.parentElement;

            // Close all other menus
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                if (dropdown.id !== menuId) {
                    dropdown.classList.remove('active');
                    dropdown.parentElement.classList.remove('active');
                }
            });

            // Toggle this menu
            const isActive = menu.classList.contains('active');
            menu.classList.toggle('active');
            menuItem.classList.toggle('active');

            activeMenu = isActive ? null : menuId;
        }

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.menu-item')) {
                document.querySelectorAll('.dropdown').forEach(dropdown => {
                    dropdown.classList.remove('active');
                    dropdown.parentElement.classList.remove('active');
                });
                activeMenu = null;
            }
        });

        // ========================================
        // Theme Management
        // ========================================
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            body.setAttribute('data-theme', newTheme);

            // Save preference
            localStorage.setItem('udos-theme', newTheme);

            addLog(`Switched to ${newTheme} mode`, 'info');
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('udos-theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
        }

        // ========================================
        // Screensaver System
        // ========================================
        let screensaverActive = false;
        let screensaverType = null;
        let screensaverInterval = null;

        function startScreensaver(type) {
            if (screensaverActive) {
                stopScreensaver();
            }

            screensaverActive = true;
            screensaverType = type;

            const overlay = document.getElementById('screensaver-overlay');
            const content = document.getElementById('screensaver-content');

            overlay.classList.add('active');
            overlay.className = `screensaver-overlay active screensaver-${type}`;

            content.innerHTML = '';

            switch(type) {
                case 'starfield':
                    initStarfield(content);
                    break;
                case 'matrix':
                    initMatrix(content);
                    break;
                case 'pipes':
                    initPipes(content);
                    break;
                case 'dvd':
                    initDVD(content);
                    break;
                case 'clock':
                    initClock(content);
                    break;
            }

            addLog(`Started ${type} screensaver`, 'info');
        }

        function stopScreensaver() {
            if (!screensaverActive) return;

            screensaverActive = false;
            const overlay = document.getElementById('screensaver-overlay');
            overlay.classList.remove('active');

            if (screensaverInterval) {
                clearInterval(screensaverInterval);
                screensaverInterval = null;
            }

            addLog(`Stopped ${screensaverType} screensaver`, 'info');
            screensaverType = null;
        }

        function showScreensaverMenu() {
            const screensavers = [
                { name: 'Starfield', type: 'starfield', icon: '⭐' },
                { name: 'Matrix Rain', type: 'matrix', icon: '🔋' },
                { name: 'DVD Logo', type: 'dvd', icon: '📀' },
                { name: 'Digital Clock', type: 'clock', icon: '🕐' }
            ];

            let menu = screensavers.map(s =>
                `${s.icon} ${s.name}`
            ).join('\\n');

            const choice = prompt(`Choose a screensaver:\\n\\n${menu}\\n\\nEnter 1-4:`);
            const index = parseInt(choice) - 1;

            if (index >= 0 && index < screensavers.length) {
                startScreensaver(screensavers[index].type);
            }
        }

        // Screensaver Implementations
        function initStarfield(container) {
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 'px';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }
        }

        function initMatrix(container) {
            container.classList.add('matrix-rain');
            const chars = 'アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン0123456789';

            for (let i = 0; i < 20; i++) {
                const column = document.createElement('div');
                column.className = 'matrix-column';
                column.style.left = (i * 5) + '%';
                column.style.animationDuration = (Math.random() * 3 + 2) + 's';
                column.style.animationDelay = Math.random() * 2 + 's';

                let text = '';
                for (let j = 0; j < 50; j++) {
                    text += chars[Math.floor(Math.random() * chars.length)] + '\\n';
                }
                column.textContent = text;
                container.appendChild(column);
            }
        }

        function initDVD(container) {
            const logo = document.createElement('div');
            logo.className = 'dvd-logo';
            logo.textContent = 'uDOS';
            container.appendChild(logo);
        }

        function initClock(container) {
            container.classList.add('screensaver-clock');
            const timeDisplay = document.createElement('div');
            const dateDisplay = document.createElement('div');
            dateDisplay.style.fontSize = '24px';
            dateDisplay.style.marginTop = '20px';

            container.appendChild(timeDisplay);
            container.appendChild(dateDisplay);

            screensaverInterval = setInterval(() => {
                const now = new Date();
                timeDisplay.textContent = now.toLocaleTimeString();
                dateDisplay.textContent = now.toLocaleDateString();
            }, 1000);
        }

        function initPipes(container) {
            // Simple pipe-like animation with CSS
            for (let i = 0; i < 10; i++) {
                const pipe = document.createElement('div');
                pipe.style.position = 'absolute';
                pipe.style.width = '20px';
                pipe.style.height = '20px';
                pipe.style.background = '#00ff00';
                pipe.style.left = Math.random() * 100 + '%';
                pipe.style.top = Math.random() * 100 + '%';
                pipe.style.animation = `dvd-bounce ${Math.random() * 5 + 3}s linear infinite`;
                container.appendChild(pipe);
            }
        }

        // ========================================
        // Workspace Functions
        // ========================================
        function openWorkspace(workspace) {
            addLog(`Opening ${workspace} workspace...`, 'info');
            // In a real implementation, this would open a file browser or terminal
            // For now, just show a notification
            setTimeout(() => {
                addLog(`${workspace} workspace: Ready`, 'success');
            }, 500);
            toggleMenu('file-menu');
        }

        function refreshDashboard() {
            addLog('Refreshing dashboard...', 'info');
            checkAllStatus();
            toggleMenu('file-menu');
        }

        // ========================================
        // System Functions
        // ========================================
        function showSystemInfo() {
            addLog('System information displayed', 'info');
            // Update platform info
            document.getElementById('platform-info').textContent = navigator.platform;
            updateQuickStatus();
            toggleMenu('settings-menu');
        }

        function showAbout() {
            addLog('About uDOS', 'info');
            alert('uDOS v1.3\\n\\nUniversal Data Operating System\\nClassic Mac OS Style Dashboard\\n\\n© 2025');
            toggleMenu('settings-menu');
        }

        function updateQuickStatus() {
            const statusEl = document.getElementById('quick-status');
            const serverCount = document.querySelectorAll('.server-status.online').length;
            const uptime = document.getElementById('metric-uptime').textContent;

            statusEl.innerHTML = `Servers: ${serverCount}/6 online\\nUptime: ${uptime}\\nPlatform: ${navigator.platform}\\nStatus: Ready`;
        }

        // ========================================
        // Help Functions
        // ========================================
        function showHelp() {
            const helpText = `uDOS Dashboard Help\\n\\n` +
                `Menu Bar:\\n` +
                `- File: Access workspaces and refresh\\n` +
                `- Extensions: Manage web extensions\\n` +
                `- System: Settings and system info\\n` +
                `- Help: Documentation and support\\n\\n` +
                `Click on server cards to manage extensions.`;

            alert(helpText);
            toggleMenu('help-menu');
        }

        function showKeyboardShortcuts() {
            const shortcuts = `Keyboard Shortcuts:\\n\\n` +
                `⌘R - Refresh Dashboard\\n` +
                `⌘S - Open Sandbox\\n` +
                `⌘M - Open Memory\\n` +
                `⌘D - Open Data\\n` +
                `⌘, - Preferences\\n` +
                `⌘? - Help`;

            alert(shortcuts);
            toggleMenu('help-menu');
        }

        function showDocs() {
            addLog('Opening documentation...', 'info');
            toggleMenu('help-menu');
        }

        // ========================================
        // Metrics Updates
        // ========================================
        let startTime = new Date();
        let requestCount = 0;

        function updateMetrics() {
            // Update uptime
            const now = new Date();
            const uptimeMs = now - startTime;
            const hours = Math.floor(uptimeMs / 3600000);
            const minutes = Math.floor((uptimeMs % 3600000) / 60000);
            const seconds = Math.floor((uptimeMs % 60000) / 1000);
            document.getElementById('metric-uptime').textContent =
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // Update start time display
            document.getElementById('start-time').textContent = startTime.toLocaleTimeString();

            // Update requests (simulated)
            if (Math.random() > 0.7) {
                requestCount++;
                document.getElementById('metric-requests').textContent = requestCount;
            }

            // Update memory (simulated)
            if (performance && performance.memory) {
                const memMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(1);
                document.getElementById('metric-memory').textContent = `${memMB} MB`;
            }

            // Update server count
            const onlineCount = document.querySelectorAll('.server-status.online').length;
            document.getElementById('metric-servers').textContent = `${onlineCount}/6`;

            const changeEl = document.getElementById('metric-servers-change');
            if (onlineCount > 0) {
                changeEl.textContent = `${onlineCount} active`;
                changeEl.className = 'metric-change';
            } else {
                changeEl.textContent = 'Ready to start';
                changeEl.className = 'metric-change';
            }
        }

        // ========================================
        // Desktop Icon Management
        // ========================================
        let selectedIcon = null;

        function handleIconClick(extensionName) {
            // Deselect previous icon
            if (selectedIcon) {
                selectedIcon.classList.remove('selected');
            }

            // Select current icon
            const icon = document.querySelector(`[data-extension="${extensionName}"]`);
            if (icon) {
                icon.classList.add('selected');
                selectedIcon = icon;

                // Show dashboard window with extension details
                showDashboard();
                addLog(`Selected ${extensionName}`, 'info');
            }
        }

        function showDashboard() {
            const dashboard = document.getElementById('dashboard-window');
            if (dashboard) {
                dashboard.style.display = 'block';
                updateMetrics();
            }
        }

        function closeDashboard() {
            const dashboard = document.getElementById('dashboard-window');
            if (dashboard) {
                dashboard.style.display = 'none';
            }

            // Deselect all icons
            if (selectedIcon) {
                selectedIcon.classList.remove('selected');
                selectedIcon = null;
            }
        }

        function openURL(url) {
            window.open(url, '_blank');
            addLog(`Opened ${url}`, 'info');
        }

        // ========================================
        // Extension Management
        // ========================================
        function openExtension(extension) {
            const port = document.querySelector(`[data-extension="${extension}"]`)?.dataset.port;
            if (port) {
                window.open(`http://localhost:${port}`, '_blank');
                addLog(`Opened ${extension} in browser`, 'info');
            }
        }

        function handleExtension(extension, action) {
            addLog(`${action} ${extension}...`, 'info');

            // Simulate server actions
            setTimeout(() => {
                const status = document.getElementById(`status-${extension}`);
                if (status) {
                    if (action === 'start') {
                        status.classList.add('online');
                        status.classList.remove('offline');
                        addLog(`${extension} started successfully`, 'success');
                    } else if (action === 'stop') {
                        status.classList.remove('online');
                        status.classList.add('offline');
                        addLog(`${extension} stopped`, 'info');
                    } else if (action === 'open') {
                        const port = document.querySelector(`[data-extension="${extension}"]`)?.dataset.port;
                        if (port) {
                            window.open(`http://localhost:${port}`, '_blank');
                            addLog(`Opened ${extension} in browser`, 'info');
                        }
                    }
                }
                updateServerCount();
            }, 500);
        }

        function startAll() {
            const extensions = ['cmd', 'markdown-viewer', 'font-editor', 'typo', 'micro'];
            extensions.forEach((ext, index) => {
                setTimeout(() => handleExtension(ext, 'start'), index * 200);
            });
        }

        function stopAll() {
            const extensions = ['cmd', 'markdown-viewer', 'font-editor', 'typo', 'micro'];
            extensions.forEach((ext, index) => {
                setTimeout(() => handleExtension(ext, 'stop'), index * 200);
            });
        }

        function updateServerCount() {
            const onlineCount = document.querySelectorAll('.icon-status.online').length;
            const serverCountElement = document.getElementById('server-count');
            const metricServerElement = document.getElementById('metric-servers');

            if (serverCountElement) {
                serverCountElement.textContent = `${onlineCount}/5 servers online`;
            }
            if (metricServerElement) {
                metricServerElement.textContent = `${onlineCount}/5`;
            }
        }

        // ========================================
        // Activity Log Management
        // ========================================
        function addLog(message, type = 'info') {
            const log = document.getElementById('activity-log');
            if (!log) return;

            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const time = document.createElement('span');
            time.className = 'log-time';
            time.textContent = new Date().toLocaleTimeString();

            const msg = document.createElement('span');
            msg.className = 'log-message';
            msg.textContent = message;

            entry.appendChild(time);
            entry.appendChild(msg);

            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }

        function clearLog() {
            const log = document.getElementById('activity-log');
            if (log) {
                log.innerHTML = '';
                addLog('Activity log cleared', 'info');
            }
        }

        // ========================================
        // Time Updates
        // ========================================
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = new Date().toLocaleTimeString();
            }
        }

        // ========================================
        // Initialization and Event Listeners
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize theme
            initializeTheme();

            updateMetrics();
            updateTime();
            showSystemInfo();
            addLog('Desktop loaded successfully', 'success');

            // Update metrics every second
            setInterval(() => {
                updateMetrics();
                updateTime();
            }, 1000);

            // Double-click to open dashboard
            document.addEventListener('dblclick', (e) => {
                if (e.target.closest('.desktop') && !e.target.closest('.desktop-icon')) {
                    showDashboard();
                }
            });

            // Screensaver click/key handlers
            document.getElementById('screensaver-overlay').addEventListener('click', stopScreensaver);
        });

        // ========================================
        // Keyboard Shortcuts
        // ========================================
        document.addEventListener('keydown', (e) => {
            if (e.metaKey || e.ctrlKey) {
                switch(e.key) {
                    case 'r':
                        e.preventDefault();
                        refreshDashboard();
                        break;
                    case 's':
                        e.preventDefault();
                        openWorkspace('sandbox');
                        break;
                    case 'm':
                        e.preventDefault();
                        openWorkspace('memory');
                        break;
                    case 'd':
                        e.preventDefault();
                        openWorkspace('data');
                        break;
                    case ',':
                        e.preventDefault();
                        showSystemInfo();
                        break;
                    case 't':
                        e.preventDefault();
                        toggleTheme();
                        break;
                }
            }

            // Escape to close dashboard or screensaver
            if (e.key === 'Escape') {
                if (screensaverActive) {
                    stopScreensaver();
                } else {
                    closeDashboard();
                }
            }
            if (e.key === 'Escape') {
                closeDashboard();
            }
        });
    </script>

    <!-- Screensaver Overlay -->
    <div id="screensaver-overlay" class="screensaver-overlay">
        <div id="screensaver-content"></div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-item">
            <span>🌀</span>
            <span>uDOS v1.3</span>
        </div>
        <div class="status-item">
            <span>⚡</span>
            <span id="server-count">0/6 servers online</span>
        </div>
        <div class="status-item">
            <span>🕐</span>
            <span id="current-time">--:--:--</span>
        </div>
    </div>

</body>
</html>
