#!/bin/bash
# Port Manager Shell Wrapper
# Quick access to port management utilities

set -e

WORKSPACE_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$WORKSPACE_ROOT"

# Activate venv if not already active
if [ -z "${VIRTUAL_ENV:-}" ]; then
    CANDIDATES=()
    if [ -n "${WIZARD_VENV_PATH:-}" ]; then
        if [[ "$WIZARD_VENV_PATH" = /* ]]; then
            CANDIDATES+=("$WIZARD_VENV_PATH")
        else
            CANDIDATES+=("$WORKSPACE_ROOT/$WIZARD_VENV_PATH")
        fi
    fi
    CANDIDATES+=(
        "$WORKSPACE_ROOT/venv"
    )
    for candidate in "${CANDIDATES[@]}"; do
        if [ -f "$candidate/bin/activate" ]; then
            # shellcheck disable=SC1090
            source "$candidate/bin/activate"
            break
        fi
    done
fi

# Run the port manager CLI
python -m wizard.cli_port_manager "$@"
